<? // include для ПО Bitrix
/**
 *	@author "Фомичев Андрей" <afomich@rambler.ru>, "Машков Владимир" <vladimir@mashkov.com>
 *	@version 2.0.0
 */
/*require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
$APPLICATION->SetPageProperty("title", "Быстрая заявка");
$APPLICATION->SetPageProperty("keywords", "ООО Полигон");
$APPLICATION->SetPageProperty("description", "ООО Полигон");
$APPLICATION->SetPageProperty("NOT_SHOW_NAV_CHAIN", "Y");*/
?>


<style type="text/css">
<!-- Вставляем стиль, необходимый для формы
.goMessage {
	color: #FF0000;
	font-family:Tahoma;
	font-size:14px;
}
.goFormsInputAndTextarea {
	border: 1px solid #000000;
}
.goTitles {
	margin-left:0px;
	font-family:Tahoma;
	font-size:12px;
}
.goAttensionTitle {
	font-family:Tahoma;
	font-size:12px;
}
.goAttensionError {
	color:#FF0000;
	font-family:Tahoma;
	font-size:12px;
}
.goButtonSend {border:solid 1px;}
.goButtonClaer {border:solid 1px;}
-->
</style>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td align="center" valign="top">
	<h2>Вы можете добавить в корзину произвольное изделие</h2>
<p><span class="goAttensionTitle"><font color="#FF0000">Внимание! </font>Все поля, кроме "Наименование" и "Количество", обязательны для заполнения:</span></p>
	<div style="text-align:left; width:320px;">
	



<?php
	//include требуемых библиотек
	include("func.inc");
	include("useragent.inc");
	
	
	
	// ниже приведенный список используется для удопства.
	$goInput = 'input'; // задаем HTML поле input
	$goTextArea = 'textarea';
	$goSixeInput = ' type="text"  size="50"  maxlength="100" '; // здесь меняем TAG input
	$goSixeTextArea  = ' cols="38" rows="3" '; // здесь меняем TAG textarea
	$goValueInputStart  = 'value="';
	$goValueInputEnd  = '">';
	$goValueTextAreaStart  = '>';
	$goValueTextAreaEnd  = '</textarea>';
	$goAttensionStart = '<span class="goAttensionError" >Обнаружены следующие ошибки:<br>';
	$goAttensionSuffix = 'не заполнено поле ';
	$goAttensionSuffixNotCorrect = 'не корректно заполнено поле ';
	$goAttensionEnd = '</span></p>';
	$goMessageWasSend = '<span class="goMessage">Спасибо за отправку Вашего сообщения!</span>';	

//***************************************** Здесь меняем и вносим требуемые условия (начало) *****************************************//		
	$goSend[To]='fromwebsite@poligon.info'; // направляем письмо в указанный ящик
	$goSend[Subject] = 'Вопрос/Заявка с сайта poligon.info'; // тема письма (иногда бывает отправляют вопрос, вместо заказа)
	$goIdOfName = 1; // Уакажите название компании. Это обязателное значение и будет фигурировать в формировании письма.
	$goIdOfEmail = 2; // укажите номер индификатора (см. в массиве $goName ниже)  для проверки Email, в случае отсутствия указать значение 0
	$goIdOfPhone = 3; // укажите номер индификатора для проверки Телефона, в случае отсутствия указать значение 0	
	

//массив $goReqParam[], может принимать только значения true или false (Поле обязательное или необязательное для заполнения); 

	$goTitle [1]='Ф.И.О.:';		$goTypeHTML [1]=$goInput; $goName[1]='name'; 	$goReqParam[1]=true; 
	$goTitle [2]='E-Mail:';		$goTypeHTML [2]=$goInput; $goName[2]='email'; 	$goReqParam[2]=true; 
	$goTitle [3]='Тел./факс:';	$goTypeHTML [3]=$goInput; $goName[3]='phone1';	$goReqParam[3]=true; 
	$goTitle [4]='Компания:';	$goTypeHTML [4]=$goInput; $goName[4]='company'; 	$goReqParam[4]=true; 
	$goTitle [5]='Должность:';	$goTypeHTML [5]=$goTextArea; $goName[5]='doljnost';	$goReqParam[5]=true; 
	$goTitle [6]='Наименование:';	$goTypeHTML [6]=$goInput; $goName[6]='article1';	$goReqParam[6]=true; 
	$goTitle [7]='Количество:';	$goTypeHTML [7]=$goInput; $goName[7]='col1';	$goReqParam[7]=true; 
	$goTitle [8]='Предполагаемая цена:';	$goTypeHTML [8]=$goInput; $goName[8]='article2';	$goReqParam[8]=false;  
	$goTitle [9]='Комментарий:';			$goTypeHTML [9]=$goTextArea; $goName[9]='comment';	$goReqParam[9]=true; 


//***************************************** Здесь меняем и вносим требуемые условия (конец) *****************************************//

//***************************************** Все, что ниже менять не рекомендуется *****************************************//

	$goKolichestvoElementov = count($goTitle); // не трогать, и неперемещать. Эта строчка должна быть внизу.
	$goDefaultSendFrom = $goSendTo; // Ящик от которого будет приходить сообщение, в случае отсутствия E-Mail отправителя в формах.
	$goCheck[email]=$goName[$goIdOfEmail];
	$goCheck[phone]=$goName[$goIdOfPhone];
	$tempWeHaveGotError = false;
	$goAttensionSuffixNotCorrectEmail = $goAttensionSuffixNotCorrect.''.$goTitle [$goIdOfEmail].'<br>';
	$goAttensionSuffixNotCorrectPhone = $goAttensionSuffixNotCorrect.''.$goTitle [$goIdOfPhone].'<br>';
	
	$boolenMessageWasSend = false;
	
	for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
	{
    		switch ($goTypeHTML [$i]) 
			{
				case ($goTextArea):
    				$goSixe[$i]=$goSixeTextArea;
					$goValueStart[$i] =	$goValueTextAreaStart ;
					$goValueEnd[$i] = $goValueTextAreaEnd ;						
    			break;
				case ($goInput):
    				$goSixe[$i]=$goSixeInput;
					$goValueStart[$i] =	$goValueInputStart ;
					$goValueEnd[$i] = $goValueInputEnd ;	
    			break;
			}	
	}
	
?>
<form method="post" action="<?PHP_SELF?>">
  <p>
<?  
		$tempAttensionStart = '';
		$tempAttensionStart = '';
		for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
		{
			$tempMyNameIs=$goName[$i];
			$tempContentForm=$_POST[($tempMyNameIs)];
			
			switch ($goReqParam [$i]) 
			{
				case (true): //Если поле обязателное для заполнения, то делаем проверку
				if (isset ($_POST [($tempMyNameIs)] ) ) // Если страницу закрузили, только что, то проверка не производиться
				{
					if ($_POST[($tempMyNameIs)] =='') // Если данные отправлены, а поля не заполнены, то сообщаем.
					{
						$tempContentFormErro[$i] = true;
						$tempAttensionStart = $goAttensionStart;
						$tempAttensionSuffix = $goAttensionSuffix;
						$tempAttensionEnd = $goAttensionEnd;
						$tempWeHaveGotError = true;
					 } else { // Если данные отправленны, но среди них есть поля для проверки на валидность, то производим проверку
						if (($_POST [($goCheck[email])]) == '') // Проверяем E-MAIL на корректность заполнения
						{ 
						$tempContentFormErro[$goIdOfEmail] = true;
						}else{
							if (validEmail($_POST [($goCheck[email])]) == true)
							{
								$tempCheckedEmail='';
							}else{
								$tempCheckedEmail= $goAttensionSuffixNotCorrectEmail;
								$tempAttensionStart = $goAttensionStart;
								$tempAttensionEnd = $goAttensionEnd;
								$tempWeHaveGotError = true;
							}
						}
						
						
						if (($_POST [($goCheck[phone])]) == '') // Проверяем Телефон на корректность заполнения
						{ 
						$tempContentFormErro[$goIdOfPhone] = true;
						}else{
							if (isPhoneNumber($_POST [($goCheck[phone])]) == true)
							{
								$tempCheckedPhone='';
							}else{
								$tempCheckedPhone= $goAttensionSuffixNotCorrectPhone;
								$tempAttensionStart = $goAttensionStart;
								$tempAttensionEnd = $goAttensionEnd;
								$tempWeHaveGotError = true;
							}
						}
								

						
					
					
					}
				}
				break;
				case (false): //Если поле не является обязательным, то пропускае проверку.
						$tempContentFormErro[$i] = false;
									
				break;
	
			}
			

		}	
if (isset ($_POST [($tempMyNameIs)] ) )
{
	if ($tempAttensionStart != $goAttensionStart) // ошибок нет, отправляем письмо.
	{
	if (!isset($HTTP_X_FORWARDED_FOR))
	{
	$HTTP_X_FORWARDED_FOR = "";
	}
	if	($HTTP_X_FORWARDED_FOR)
	{
		$ip = getenv("HTTP_X_FORWARDED_FOR");
		$proxy = getenv("REMOTE_ADDR");
		$host = gethostbyaddr($REMOTE_ADDR);
	}else {
		$ip = getenv("REMOTE_ADDR");
		$host = gethostbyaddr($REMOTE_ADDR);
		$proxy = "";
	}
		
	$userAgent = $HTTP_USER_AGENT;
	$browser = getBrowser($arrBrowser,$userAgent);
	$system = getSystem($arrSystem,$userAgent);
	$server = $HTTP_HOST;
		
	$goGetName=($_POST [($goName[$goIdOfName])]);
	if ($goIdOfEmail != 0) 
	{
		$goGetEmail = ($_POST [($goCheck[email])]);
	}else{
		$goGetEmail = $goDefaultSendFrom;
	}
	
	
	
	for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
	{
		$tempMyNameIs=$goName[$i];
		$tempContentForm=$_POST[($tempMyNameIs)];
		$goMailBody = $goMailBody.$goTitle [$i]."	".$tempContentForm."\n" ;
	}
	
	$goMailBody = $goMailBody."\n\nДата: [".getFullDate(time()).", ".getQuestionTime(time())."]\n--------------------\n\n";
	$tempSendMeFrom = 'From: '.$goGetName.'<'.$goGetEmail.'>'."nReply-To: ".$goGetEmail."\nContent-Type: text/plain; charset=windows-1251\nContent-Transfer-Encoding: 8bit" ;
	$tempSendMe = $goSend[To]."\r\n".$goSend[Subject]."\r\n".$goMailBody."\r\n".$tempSendMeFrom."\r\n \r\n";
			/**
		 *	Send email with message to admin
		 */
	@mail($goSend[To], $goSend[Subject], $goMailBody, $tempSendMeFrom);
	
	#writeDataInFile ($tempSendMe);
	
	//Сообщаем, что все отправлено
	echo $goMessageWasSend.'<br><br>';	
	$boolenMessageWasSend = true;


	
	}
}
//Печатаем сообщение о ошибке				
echo $tempAttensionStart;
	for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
	{
		if ($tempContentFormErro[$i] == true) 
		{
			echo $tempAttensionSuffix.$goTitle[$i].'<br>';
		}
	}


echo $tempCheckedEmail.$tempCheckedPhone.$tempAttensionEnd;

//Печатаем список полей и кнопки
if ($boolenMessageWasSend == false)
{
		for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
		{
		
			$tempMyNameIs=$goName[$i];
			$tempContentForm=$_POST[($tempMyNameIs)];
			echo '<font class="goTitles">'.$goTitle[$i].'</font><br>
			<'.$goTypeHTML[$i].' name="'.$goName[$i].'" class="goFormsInputAndTextarea"	id="'.$goName[$i].'"	'.$goSixe[$i].$goValueStart[$i].$tempContentForm.$goValueEnd[$i].'
			';
			if($i == 5 OR $i == 7 OR $i == 9 OR $i == 11 OR $i == 13 OR $i == 15) {echo '';};
		}
		echo '<p>
				<!-- Печатаем кнопки-->
				<input class="goButtonSend" type="submit" value="Отправить заявку" name="submit">
				<input class="goButtonClaer" type="reset" value="Очистить">
			</p>';
}
		
if ($boolenMessageWasSend == true)
{
			for ($i = 1; $i <= $goKolichestvoElementov; $i++) 
			{
		
			$tempMyNameIs=$goName[$i];
			$tempContentForm=$_POST[($tempMyNameIs)];
			echo '<font class="goTitles">'.$goTitle[$i].' &#8212; '.$tempContentForm.'</font><br>';
			if($i == 5 OR $i == 7 OR $i == 9 OR $i == 11 OR $i == 13 OR $i == 15) {echo '<br />';};
			}
}
?>




</form>
</div>
	</td>
  </tr>
</table>
<?// require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php"); ?>
